require "rspec/core/rake_task"

RSpec::Core::RakeTask.new(:spec)

task :default => :spec

desc "Parse UAA Spring Security XML config and output our YAML format"
task :parse do
  require 'nokogiri'
  require 'yaml'
  require_relative 'lib/uaa_spring_security_utils'
  glob = '../../../uaa/uaa/src/main/webapp/**/*.xml'
  path = File.join(File.dirname(File.expand_path(__FILE__)), glob)
  puts '# GENERATED FILE - DO NOT EDIT.'
  puts '# GENERATED BY ' + UaaSpringSecurityUtils::ConfigParser.name
  puts "# Config files from: #{glob}"
  parser = UaaSpringSecurityUtils::ConfigParser.new(path)
  parser.parse
  puts parser.to_yaml
end
